<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive Interactive Guide to Excel VBA with AI Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chosen Palette: Material Blue & Grey -->
    <!-- Application Structure Plan: The application uses a fixed sidebar for navigation and a main content area, a proven structure for documentation sites. This allows users to follow a structured path or jump to topics. The redesign incorporates Material Design principles with cards, icons, and improved typography for better visual hierarchy. A new "Projects" section has been added to provide practical, end-to-end examples, which is crucial for applied learning. Interactive elements like the object model explorer and tabbed code sections are retained and enhanced with Material Icons to make complex topics more digestible. A new "AI Assistant" section powered by the Gemini API provides code generation, explanation, and error fixing capabilities. The layout is now fully responsive, featuring a collapsible sidebar for mobile views. -->
    <!-- Visualization & Content Choices: 
        - Report Info: All VBA concepts -> Goal: Inform/Teach -> Viz/Presentation: Content organized into cards with Material Icons for visual cues -> Interaction: Sidebar navigation, interactive diagrams -> Justification: Improves readability, visual appeal, and helps users associate icons with concepts.
        - Report Info: Real-world projects -> Goal: Apply knowledge -> Viz/Presentation: A new dedicated section with step-by-step project guides -> Interaction: Users can read through the build process and copy code -> Justification: Directly addresses the user request for practical application, bridging theory and practice.
        - Report Info: Gemini API Integration -> Goal: Assist/Accelerate -> Viz/Presentation: A dedicated "AI Assistant" section with distinct cards for code generation, explanation, and debugging. -> Interaction: Users input text, click a button, and receive AI-generated output. -> Justification: Provides powerful, on-demand support that significantly enhances the learning and development process.
        - Report Info: Excel Object Model -> Goal: Organize/Inform -> Viz/Presentation: Interactive tree diagram with Material Icons (account_tree, folder, description) -> Interaction: Click to expand/collapse -> Justification: The visual hierarchy is made clearer and more intuitive with recognizable icons.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f4f6f8;
        }
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
            vertical-align: bottom;
        }
        .fira-code { font-family: 'Fira Code', monospace; }
        .content-section { display: none; }
        .content-section.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .nav-link {
            transition: all 0.2s ease-in-out;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .nav-link.active {
            background-color: #e3f2fd;
            color: #1976d2;
            border-left: 4px solid #1976d2;
            font-weight: 500;
        }
        .nav-link:hover { background-color: #eeeeee; }
        .code-block {
            background-color: #263238;
            color: #eceff1;
            border-radius: 0.5rem;
            padding: 1rem;
            position: relative;
        }
        .copy-btn {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            background-color: #455a64;
            color: white;
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            cursor: pointer;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        .copy-btn:hover { background-color: #607d8b; }
        .object-model-item {
            margin-left: 20px;
            padding-left: 20px;
            border-left: 2px solid #cfd8dc;
        }
        .object-model-item .children { display: none; }
        .object-model-item.expanded > .children { display: block; }
        .object-model-item > .item-header { display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 4px 0; }
        .object-model-item > .item-header:hover { color: #1976d2; }
        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .ai-output {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
            min-height: 100px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="relative min-h-screen md:flex">
        <!-- Mobile Menu Toggle Button -->
        <div class="bg-white text-gray-800 flex justify-between md:hidden sticky top-0 z-20 shadow-md">
            <a href="#" class="block p-4 font-bold text-blue-800">VBA Learning Hub</a>
            <button id="mobile-menu-button" class="p-4 focus:outline-none focus:bg-gray-200">
                <span class="material-symbols-outlined">menu</span>
            </button>
        </div>

        <!-- Sidebar -->
        <aside id="sidebar" class="bg-white w-72 text-gray-800 space-y-6 py-7 px-2 absolute inset-y-0 left-0 transform -translate-x-full md:relative md:translate-x-0 transition duration-200 ease-in-out z-30 shadow-lg md:shadow-none">
            <div class="px-4 border-b pb-4">
                <h1 class="text-xl font-bold text-blue-800 flex items-center gap-2">
                    <span class="material-symbols-outlined text-blue-600">integration_instructions</span>
                    VBA Learning Hub
                </h1>
                <p class="text-sm text-gray-500">From Novice to Automation Master</p>
            </div>
            <nav id="main-nav" class="flex-grow overflow-y-auto">
                <a href="#part1" class="nav-link p-4 text-gray-700"><span class="material-symbols-outlined">rocket_launch</span>Part I: Getting Started</a>
                <a href="#part2" class="nav-link p-4 text-gray-700"><span class="material-symbols-outlined">code</span>Part II: Core Language</a>
                <a href="#part3" class="nav-link p-4 text-gray-700"><span class="material-symbols-outlined">account_tree</span>Part III: Excel Object Model</a>
                <a href="#part4" class="nav-link p-4 text-gray-700"><span class="material-symbols-outlined">build</span>Part IV: Building Solutions</a>
                <a href="#part5" class="nav-link p-4 text-gray-700"><span class="material-symbols-outlined">extension</span>Part V: Advanced Toolkit</a>
                <a href="#part6" class="nav-link p-4 text-gray-700"><span class="material-symbols-outlined">verified</span>Part VI: Best Practices</a>
                <a href="#part7" class="nav-link p-4 text-gray-700"><span class="material-symbols-outlined">assignment</span>Part VII: Real-World Projects</a>
                <a href="#part8" class="nav-link p-4 text-gray-700"><span class="material-symbols-outlined text-purple-500">auto_awesome</span>Part VIII: AI Assistant</a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-6 md:p-10 overflow-y-auto">
            
            <!-- Part I to VII Sections remain the same as previous version -->
            <section id="part1" class="content-section">
                <h2 class="text-3xl font-bold mb-4 text-gray-900 flex items-center gap-3"><span class="material-symbols-outlined text-3xl text-blue-600">rocket_launch</span>Part I: Getting Started with VBA</h2>
                <p class="mb-6 text-lg text-gray-600">This foundational part ensures you're properly oriented and have your environment set up correctly. It answers the crucial "what" and "why" questions before diving into the "how."</p>
                <div class="card">
                    <h3 class="text-2xl font-semibold mb-3 flex items-center gap-2"><span class="material-symbols-outlined text-blue-500">help_outline</span>What is VBA?</h3>
                    <p>Visual Basic for Applications (VBA) is a programming language embedded within Microsoft Office applications. Its primary purpose is to automate repetitive tasks and extend the built-in functionality of programs like Excel. Nearly any operation you can perform manually—from formatting a cell to creating a chart or sending an email—can be scripted and executed with VBA, saving time and reducing errors. It acts as a powerful "digital glue" that can bind the entire Office ecosystem together, allowing Excel to control Word, Outlook, and more.</p>
                </div>
                <div class="card">
                    <h3 class="text-2xl font-semibold mb-3 flex items-center gap-2"><span class="material-symbols-outlined text-blue-500">developer_mode</span>Activating the Developer Tab</h3>
                    <p class="mb-4">The gateway to all VBA tools is the Developer tab, which is hidden by default. Here's how to enable it:</p>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="bg-gray-50 p-4 rounded-lg border">
                            <h4 class="font-semibold flex items-center gap-2"><span class="material-symbols-outlined">desktop_windows</span>For Windows:</h4>
                            <ol class="list-decimal list-inside text-gray-700 mt-2">
                                <li>Go to <span class="font-semibold">File > Options</span>.</li>
                                <li>Select <span class="font-semibold">Customize Ribbon</span>.</li>
                                <li>In the right-hand list, check the box for <span class="font-semibold">Developer</span>.</li>
                                <li>Click <span class="font-semibold">OK</span>.</li>
                            </ol>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg border">
                            <h4 class="font-semibold flex items-center gap-2"><span class="material-symbols-outlined">laptop_mac</span>For macOS:</h4>
                            <ol class="list-decimal list-inside text-gray-700 mt-2">
                                <li>Go to <span class="font-semibold">Excel > Preferences</span>.</li>
                                <li>Select <span class="font-semibold">Ribbon & Toolbar</span>.</li>
                                <li>In the right-hand list, check the box for <span class="font-semibold">Developer</span>.</li>
                                <li>Click <span class="font-semibold">Save</span>.</li>
                            </ol>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <h3 class="text-2xl font-semibold mb-3 flex items-center gap-2"><span class="material-symbols-outlined text-blue-500">wysiwyg</span>The Visual Basic Editor (VBE)</h3>
                    <p>The VBE is your command center for writing and editing VBA code. Open it from the Developer tab or with the universal shortcut <kbd class="px-2 py-1.5 text-xs font-semibold text-gray-800 bg-gray-100 border border-gray-200 rounded-lg">Alt + F11</kbd> (Windows) or <kbd class="px-2 py-1.5 text-xs font-semibold text-gray-800 bg-gray-100 border border-gray-200 rounded-lg">Opt + F11</kbd> (macOS). It runs in a separate window, allowing you to write code and see its effects in Excel simultaneously.</p>
                </div>
            </section>
            <section id="part2" class="content-section">
                <h2 class="text-3xl font-bold mb-4 text-gray-900 flex items-center gap-3"><span class="material-symbols-outlined text-3xl text-blue-600">code</span>Part II: The Language of VBA</h2>
                <p class="mb-6 text-lg text-gray-600">This section covers the fundamental building blocks of any VBA program, from variables and data types to control structures like loops and conditional logic.</p>
                <div class="card">
                    <h3 class="text-2xl font-semibold mb-3">Procedures: `Sub` vs. `Function`</h3>
                    <p class="mb-4">All VBA code lives inside procedures. Understanding the two main types is crucial. A `Sub` performs an action, while a `Function` returns a value.</p>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="border border-blue-200 bg-blue-50 p-4 rounded-lg">
                            <h4 class="font-bold text-lg text-blue-800 flex items-center gap-2"><span class="material-symbols-outlined">play_arrow</span>Sub Procedures</h4>
                            <p class="mt-2">A `Sub` performs an action but **does not** return a value. Use it to automate tasks like formatting a report or saving a file.</p>
                            <pre class="code-block mt-2 fira-code text-sm"><button class="copy-btn"><span class="material-symbols-outlined text-sm">content_copy</span>Copy</button><span class="text-pink-400">Sub</span> FormatReportHeader()
    Range("A1").Font.Bold = <span class="text-yellow-300">True</span>
<span class="text-pink-400">End Sub</span></pre>
                        </div>
                        <div class="border border-green-200 bg-green-50 p-4 rounded-lg">
                            <h4 class="font-bold text-lg text-green-800 flex items-center gap-2"><span class="material-symbols-outlined">functions</span>Function Procedures</h4>
                            <p class="mt-2">A `Function` performs a calculation and **returns** a value. Use it to create custom formulas you can use in your worksheet cells.</p>
                            <pre class="code-block mt-2 fira-code text-sm"><button class="copy-btn"><span class="material-symbols-outlined text-sm">content_copy</span>Copy</button><span class="text-pink-400">Function</span> CalculateVAT(amount <span class="text-pink-400">As Double</span>) <span class="text-pink-400">As Double</span>
    CalculateVAT = amount * 0.2
<span class="text-pink-400">End Function</span></pre>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <h3 class="text-2xl font-semibold mb-3">Variables, Data Types, and Scope</h3>
                    <p class="mb-4">Variables are named storage locations for data. Declaring them with the correct data type and understanding their scope (where they can be used) is key to writing efficient, error-free code. Always use <code class="fira-code text-sm bg-gray-200 p-1 rounded">Option Explicit</code> at the top of your modules to enforce variable declaration.</p>
                    <p class="mb-4"><b>Scope</b> determines a variable's lifetime and accessibility:
                        <ul class="list-disc list-inside ml-4 mt-2">
                            <li><b>Procedure-level (`Dim` inside a Sub/Function):</b> Exists only while the procedure runs. Most common and safest.</li>
                            <li><b>Module-level (`Private` at top of module):</b> Accessible to all procedures in that module.</li>
                            <li><b>Public-level (`Public` at top of module):</b> Accessible from anywhere in the project. Use sparingly.</li>
                        </ul>
                    </p>
                </div>
                <div class="card">
                    <h3 class="text-2xl font-semibold mb-3">Control Flow: Loops and Conditionals</h3>
                    <p class="mb-4">Control flow statements allow you to dictate the path of execution through your code, enabling decision-making and repetition.</p>
                    <div id="loop-tabs">
                        <div class="border-b border-gray-200">
                            <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                                <button class="tab-btn flex items-center gap-2 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-blue-500 text-blue-600" data-target="if-then"><span class="material-symbols-outlined">call_split</span>If...Then</button>
                                <button class="tab-btn flex items-center gap-2 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-target="for-next"><span class="material-symbols-outlined">repeat</span>For...Next</button>
                                <button class="tab-btn flex items-center gap-2 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-target="for-each"><span class="material-symbols-outlined">repeat_on</span>For Each</button>
                                <button class="tab-btn flex items-center gap-2 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-target="do-loop"><span class="material-symbols-outlined">all_inclusive</span>Do...Loop</button>
                            </nav>
                        </div>
                        <div class="mt-4">
                            <div id="if-then" class="tab-content">
                                <p><span class="font-semibold">Use when:</span> You need to make a decision. `Select Case` is a cleaner alternative for checking one variable against many values.</p>
                                <pre class="code-block mt-2 fira-code text-sm"><button class="copy-btn"><span class="material-symbols-outlined text-sm">content_copy</span>Copy</button><span class="text-pink-400">If</span> sales > 10000 <span class="text-pink-400">Then</span>
    bonus = 500
<span class="text-pink-400">ElseIf</span> sales > 5000 <span class="text-pink-400">Then</span>
    bonus = 200
<span class="text-pink-400">Else</span>
    bonus = 0
<span class="text-pink-400">End If</span></pre>
                            </div>
                            <div id="for-next" class="tab-content hidden">
                                <p><span class="font-semibold">Use when:</span> You know exactly how many times you need to repeat an action.</p>
                                <pre class="code-block mt-2 fira-code text-sm"><button class="copy-btn"><span class="material-symbols-outlined text-sm">content_copy</span>Copy</button><span class="text-pink-400">Dim</span> i <span class="text-pink-400">As Long</span>
<span class="text-pink-400">For</span> i = 1 <span class="text-pink-400">To</span> 10
    Cells(i, 1).Value = i
<span class="text-pink-400">Next</span> i</pre>
                            </div>
                            <div id="for-each" class="tab-content hidden">
                                <p><span class="font-semibold">Use when:</span> You need to perform an action on every object in a collection (e.g., every cell in a range).</p>
                                <pre class="code-block mt-2 fira-code text-sm"><button class="copy-btn"><span class="material-symbols-outlined text-sm">content_copy</span>Copy</button><span class="text-pink-400">Dim</span> cell <span class="text-pink-400">As Range</span>
<span class="text-pink-400">For Each</span> cell <span class="text-pink-400">In</span> Selection.Cells
    <span class="text-pink-400">If</span> cell.Value < 0 <span class="text-pink-400">Then</span> cell.Interior.Color = vbRed
<span class="text-pink-400">Next</span> cell</pre>
                            </div>
                            <div id="do-loop" class="tab-content hidden">
                                <p><span class="font-semibold">Use when:</span> The repetition depends on a condition, not a fixed count (e.g., process rows until you find a blank cell).</p>
                                <pre class="code-block mt-2 fira-code text-sm"><button class="copy-btn"><span class="material-symbols-outlined text-sm">content_copy</span>Copy</button><span class="text-pink-400">Do While</span> Not IsEmpty(ActiveCell)
    <span class="text-green-400">' Process cell</span>
    ActiveCell.Offset(1, 0).Select
<span class="text-pink-400">Loop</span></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <section id="part3" class="content-section">
                <h2 class="text-3xl font-bold mb-4 text-gray-900 flex items-center gap-3"><span class="material-symbols-outlined text-3xl text-blue-600">account_tree</span>Part III: Mastering the Excel Object Model</h2>
                <p class="mb-6 text-lg text-gray-600">This is the most critical part for Excel automation. The Object Model is the hierarchy of all elements in Excel. Understanding how to navigate it is the key to controlling the application.</p>
                <div class="card">
                    <h3 class="text-2xl font-semibold mb-3">Interactive Object Hierarchy</h3>
                    <p class="mb-4">Click the items below to explore the structure. This hierarchy is how VBA sees Excel. To control a cell, you must navigate from the Application down to the Range.</p>
                    <div id="object-model-viz" class="p-4 border rounded-lg bg-gray-50">
                        <!-- Object model will be generated by JS -->
                    </div>
                </div>
                <div class="card">
                    <h3 class="text-2xl font-semibold mb-3">Best Practice: Referencing Objects</h3>
                    <p class="mb-4">Avoid relying on `ActiveSheet` or `ActiveWorkbook`. Your code can easily break if the user clicks somewhere else. Always be explicit by using fully qualified references or, even better, object variables.</p>
                     <div class="grid md:grid-cols-2 gap-6">
                        <div class="border border-red-300 bg-red-50 p-4 rounded-lg">
                            <h4 class="font-bold text-lg text-red-700 flex items-center gap-2"><span class="material-symbols-outlined">dangerous</span>Unreliable Code</h4>
                            <p class="mt-2">This code acts on whatever sheet is currently active. It's dangerous!</p>
                            <pre class="code-block mt-2 fira-code text-sm"><button class="copy-btn"><span class="material-symbols-outlined text-sm">content_copy</span>Copy</button>Range("A1").ClearContents</pre>
                        </div>
                        <div class="border border-green-300 bg-green-50 p-4 rounded-lg">
                            <h4 class="font-bold text-lg text-green-700 flex items-center gap-2"><span class="material-symbols-outlined">task_alt</span>Robust Code</h4>
                            <p class="mt-2">This code explicitly targets a specific worksheet. It's safe and reliable.</p>
                            <pre class="code-block mt-2 fira-code text-sm"><button class="copy-btn"><span class="material-symbols-outlined text-sm">content_copy</span>Copy</button><span class="text-pink-400">Dim</span> ws <span class="text-pink-400">As Worksheet</span>
<span class="text-pink-400">Set</span> ws = ThisWorkbook.Worksheets("Data")
ws.Range("A1").ClearContents</pre>
                        </div>
                    </div>
                </div>
            </section>
            <section id="part4" class="content-section">
                <h2 class="text-3xl font-bold mb-4 text-gray-900 flex items-center gap-3"><span class="material-symbols-outlined text-3xl text-blue-600">build</span>Part IV: Building Sophisticated Solutions</h2>
                <p class="mb-6 text-lg text-gray-600">Move beyond basic manipulation to creating interactive and robust applications with UserForms and proper error handling.</p>
                <div class="card">
                    <h3 class="text-2xl font-semibold mb-3">Interacting with the User</h3>
                    <p class="mb-4">VBA provides simple tools for user communication (`MsgBox`, `InputBox`) and more advanced tools for custom interfaces (`UserForms`). UserForms are the key to creating professional-feeling applications with custom GUIs containing text boxes, dropdowns, buttons, and more.</p>
                </div>
                <div class="card">
                    <h3 class="text-2xl font-semibold mb-3">Error Handling</h3>
                    <p class="mb-4">Runtime errors will crash your program. Good error handling with `On Error GoTo` anticipates problems and manages them gracefully. This is non-negotiable for professional code.</p>
                     <pre class="code-block mt-2 fira-code text-sm"><button class="copy-btn"><span class="material-symbols-outlined text-sm">content_copy</span>Copy</button><span class="text-pink-400">Sub</span> ErrorHandlingExample()
    <span class="text-pink-400">On Error GoTo</span> MyErrorHandler
    <span class="text-pink-400">Dim</span> x <span class="text-pink-400">As Integer</span>: x = 1 / 0
    <span class="text-pink-400">Exit Sub</span>
<span class="text-yellow-300">MyErrorHandler:</span>
    MsgBox "Error " & Err.Number & ": " & Err.Description
<span class="text-pink-400">End Sub</span></pre>
                </div>
            </section>
            <section id="part5" class="content-section">
                <h2 class="text-3xl font-bold mb-4 text-gray-900 flex items-center gap-3"><span class="material-symbols-outlined text-3xl text-blue-600">extension</span>Part V: The Ultimate VBA Toolkit</h2>
                <p class="mb-6 text-lg text-gray-600">Elevate your skills from simple scripting to building powerful, scalable applications with advanced data structures and external interactions.</p>
                <div class="card">
                    <h3 class="text-2xl font-semibold mb-3">High-Performance Data Processing with Arrays</h3>
                    <p class="mb-4">One of the most significant VBA optimization techniques is to minimize interaction with the worksheet. Reading a range into an array, processing it in memory, and writing it back is orders of magnitude faster than looping through cells.</p>
                    <pre class="code-block mt-2 fira-code text-sm"><button class="copy-btn"><span class="material-symbols-outlined text-sm">content_copy</span>Copy</button><span class="text-pink-400">Dim</span> dataArray <span class="text-pink-400">As Variant</span>
dataArray = Range("A1:E1000").Value
<span class="text-pink-400">For</span> i = 1 <span class="text-pink-400">To</span> 1000
    dataArray(i, 5) = dataArray(i, 3) * dataArray(i, 4)
<span class="text-pink-400">Next</span> i
Range("A1:E1000").Value = dataArray</pre>
                </div>
                <div class="card">
                    <h3 class="text-2xl font-semibold mb-3">Collections and Dictionaries</h3>
                    <p class="mb-4">For flexible data management, use Collections or Dictionaries. Dictionaries are superior for fast lookups using a unique key, making them ideal for checking for duplicates or finding records by an ID.</p>
                </div>
                <div class="card">
                    <h3 class="text-2xl font-semibold mb-3">Controlling Other Applications & The Web</h3>
                    <p class="mb-4">VBA's power extends beyond Excel. You can write code in Excel to automate Word and Outlook. You can also communicate with web APIs to pull live data (e.g., stock quotes, weather) directly into your sheets.</p>
                </div>
            </section>
            <section id="part6" class="content-section">
                <h2 class="text-3xl font-bold mb-4 text-gray-900 flex items-center gap-3"><span class="material-symbols-outlined text-3xl text-blue-600">verified</span>Part VI: From Code to Craftsmanship</h2>
                <p class="mb-6 text-lg text-gray-600">Refine your code, ensure it is professional, secure, and easily distributable.</p>
                <div class="card">
                    <h3 class="text-2xl font-semibold mb-3">Code Optimization</h3>
                    <ol class="list-decimal list-inside space-y-3">
                        <li><b class="font-semibold">Turn Off Screen Updating:</b> Wrap your code in `Application.ScreenUpdating = False` and `True`.</li>
                        <li><b class="font-semibold">Minimize Worksheet Interaction:</b> Use arrays for data processing.</li>
                        <li><b class="font-semibold">Avoid `.Select` and `.Activate`:</b> Directly reference objects.</li>
                    </ol>
                </div>
                <div class="card">
                    <h3 class="text-2xl font-semibold mb-3">Distributing Your Solutions as Add-ins</h3>
                    <p class="mb-4">To share your macros or custom functions, save your project as an <b class="font-semibold">Excel Add-in (.xlam)</b> file. This is the professional way to deploy VBA solutions, making them available globally within a user's Excel environment.</p>
                </div>
            </section>
            <section id="part7" class="content-section">
                <h2 class="text-3xl font-bold mb-4 text-gray-900 flex items-center gap-3"><span class="material-symbols-outlined text-3xl text-blue-600">assignment</span>Part VII: Real-World Projects</h2>
                <p class="mb-6 text-lg text-gray-600">Apply your knowledge by building practical solutions from start to finish. These projects integrate multiple concepts from the guide.</p>
                <div class="card">
                    <h3 class="text-2xl font-semibold mb-3">Project 1: Automated Report Formatter</h3>
                    <p class="mb-4"><b>Objective:</b> Create a macro that takes a raw, unformatted data export and automatically transforms it into a professional-looking report.</p>
                    <h4 class="font-semibold mt-4 mb-2">Build Process:</h4>
                    <ol class="list-decimal list-inside space-y-2">
                        <li><b>Setup:</b> Create a `Sub` procedure. Declare object variables for the worksheet and the data range.</li>
                        <li><b>Define Dynamic Range:</b> Use `CurrentRegion` to identify the entire block of raw data. This makes the code adaptable to reports of any size.</li>
                        <li><b>Clean & Format:</b>
                            <ul class="list-disc list-inside ml-6 mt-1">
                                <li>Clear any previous formatting.</li>
                                <li>Apply bold formatting and a background color to the header row.</li>
                                <li>Use the `.AutoFit` method on columns to adjust their width.</li>
                                <li>Apply number formatting (e.g., currency, percentage) to data columns.</li>
                            </ul>
                        </li>
                        <li><b>Add Totals:</b> Add a "Total" row at the bottom and use the `.Formula` property to insert `=SUM()` formulas.</li>
                    </ol>
                    <pre class="code-block mt-4 fira-code text-sm"><button class="copy-btn"><span class="material-symbols-outlined text-sm">content_copy</span>Copy</button><span class="text-pink-400">Sub</span> FormatSalesReport()
    <span class="text-pink-400">Dim</span> ws <span class="text-pink-400">As Worksheet</span>
    <span class="text-pink-400">Dim</span> dataRange <span class="text-pink-400">As Range</span>
    <span class="text-pink-400">Dim</span> lastRow <span class="text-pink-400">As Long</span>

    <span class="text-pink-400">Set</span> ws = ThisWorkbook.Worksheets("SalesData")
    <span class="text-pink-400">Set</span> dataRange = ws.Range("A1").CurrentRegion
    
    <span class="text-green-400">' 1. Clean and Format</span>
    dataRange.Columns.AutoFit
    dataRange.Interior.Color = xlNone
    <span class="text-pink-400">With</span> dataRange.Rows(1).Font
        .Bold = <span class="text-yellow-300">True</span>
        .Size = 12
    <span class="text-pink-400">End With</span>
    dataRange.Columns(3).NumberFormat = "$#,##0.00" <span class="text-green-400">' Sales Amount</span>

    <span class="text-green-400">' 2. Add Totals</span>
    lastRow = dataRange.Rows.Count
    ws.Cells(lastRow + 1, 2).Value = "Total"
    ws.Cells(lastRow + 1, 3).Formula = "=SUM(C2:C" & lastRow & ")"
<span class="text-pink-400">End Sub</span></pre>
                </div>
                <div class="card">
                    <h3 class="text-2xl font-semibold mb-3">Project 2: Interactive Data Entry Form</h3>
                    <p class="mb-4"><b>Objective:</b> Build a custom UserForm to capture new employee information and add it to a database table on a hidden worksheet.</p>
                    <h4 class="font-semibold mt-4 mb-2">Build Process:</h4>
                    <ol class="list-decimal list-inside space-y-2">
                        <li><b>Design the Form:</b> Create a new UserForm. Add `Label` and `TextBox` controls for "Employee Name", "Department", and "Start Date". Add `CommandButton` controls for "Submit" and "Cancel".</li>
                        <li><b>Code the 'Cancel' Button:</b> In the `Click` event for the Cancel button, simply add the line `Unload Me` to close the form.</li>
                        <li><b>Code the 'Submit' Button:</b> This is the core logic.
                            <ul class="list-disc list-inside ml-6 mt-1">
                                <li>Declare a variable for the database worksheet.</li>
                                <li>Find the next empty row in the database sheet using `.End(xlUp).Offset(1, 0)`.</li>
                                <li>Perform basic validation: check if the text boxes are empty. If so, show a `MsgBox` and exit the sub.</li>
                                <li>Write the values from the form's text boxes to the cells in the next empty row.</li>
                                <li>Clear the text boxes for the next entry.</li>
                                <li>Show a confirmation `MsgBox` to the user.</li>
                            </ul>
                        </li>
                        <li><b>Show the Form:</b> Create a simple `Sub` in a standard module to call `YourFormName.Show`.</li>
                    </ol>
                     <pre class="code-block mt-4 fira-code text-sm"><button class="copy-btn"><span class="material-symbols-outlined text-sm">content_copy</span>Copy</button><span class="text-green-400">' Code for the "Submit" button's Click event on the UserForm</span>
<span class="text-pink-400">Private Sub</span> SubmitButton_Click()
    <span class="text-pink-400">Dim</span> dbSheet <span class="text-pink-400">As Worksheet</span>
    <span class="text-pink-400">Dim</span> nextRow <span class="text-pink-400">As Range</span>

    <span class="text-pink-400">Set</span> dbSheet = ThisWorkbook.Worksheets("Database")
    <span class="text-pink-400">Set</span> nextRow = dbSheet.Cells(dbSheet.Rows.Count, 1).End(xlUp).Offset(1, 0)

    <span class="text-green-400">' Validation</span>
    <span class="text-pink-400">If</span> Me.NameTextBox.Value = "" <span class="text-pink-400">Then</span>
        MsgBox "Employee Name is required.", vbExclamation
        <span class="text-pink-400">Exit Sub</span>
    <span class="text-pink-400">End If</span>
    
    <span class="text-green-400">' Write data</span>
    nextRow.Value = Me.NameTextBox.Value
    nextRow.Offset(0, 1).Value = Me.DepartmentTextBox.Value
    nextRow.Offset(0, 2).Value = CDate(Me.DateTextBox.Value)

    MsgBox "Employee added successfully!", vbInformation
<span class="text-pink-400">End Sub</span></pre>
                </div>
            </section>

            <!-- Part VIII: AI Assistant -->
            <section id="part8" class="content-section">
                <h2 class="text-3xl font-bold mb-4 text-gray-900 flex items-center gap-3"><span class="material-symbols-outlined text-3xl text-purple-500">auto_awesome</span>Part VIII: AI Assistant</h2>
                <p class="mb-6 text-lg text-gray-600">Leverage the power of AI to accelerate your VBA development. These tools, powered by the Gemini API, can help you write, understand, and debug code faster.</p>

                <div class="card">
                    <h3 class="text-2xl font-semibold mb-3 flex items-center gap-2"><span class="material-symbols-outlined text-blue-500">translate</span>Code Explainer</h3>
                    <p class="mb-4">Stuck on a complex piece of code? Paste it below and let the AI explain it to you in plain English.</p>
                    <textarea id="explain-input" class="w-full p-2 border rounded fira-code" rows="8" placeholder="Paste your VBA code here..."></textarea>
                    <button id="explain-btn" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 flex items-center gap-2">
                        ✨ Explain Code
                    </button>
                    <div id="explain-output" class="ai-output fira-code"></div>
                </div>

                <div class="card">
                    <h3 class="text-2xl font-semibold mb-3 flex items-center gap-2"><span class="material-symbols-outlined text-green-500">tips_and_updates</span>Code Generator</h3>
                    <p class="mb-4">Describe the task you want to automate, and the AI will generate the VBA code for you.</p>
                    <textarea id="generate-input" class="w-full p-2 border rounded" rows="4" placeholder="e.g., 'Create a macro to delete all blank rows on the active sheet'"></textarea>
                    <button id="generate-btn" class="mt-4 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 flex items-center gap-2">
                        ✨ Generate Code
                    </button>
                    <div id="generate-output" class="ai-output">
                        <pre class="code-block fira-code text-sm"></pre>
                    </div>
                </div>

                <div class="card">
                    <h3 class="text-2xl font-semibold mb-3 flex items-center gap-2"><span class="material-symbols-outlined text-red-500">bug_report</span>Error Helper</h3>
                    <p class="mb-4">Getting an error message you don't understand? Paste it here for a possible explanation and solution.</p>
                    <textarea id="error-input" class="w-full p-2 border rounded" rows="2" placeholder="e.g., 'Run-time error '9': Subscript out of range'"></textarea>
                    <button id="error-btn" class="mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 flex items-center gap-2">
                        ✨ Suggest Fix
                    </button>
                    <div id="error-output" class="ai-output fira-code"></div>
                </div>
            </section>

        </main>
    </div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const sidebar = document.getElementById('sidebar');
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const navLinks = document.querySelectorAll('#main-nav a');
    const contentSections = document.querySelectorAll('.content-section');
    const loopTabs = document.querySelectorAll('#loop-tabs .tab-btn');
    const loopContents = document.querySelectorAll('#loop-tabs .tab-content');
    const copyButtons = document.querySelectorAll('.copy-btn');

    // Toggle mobile menu
    mobileMenuButton.addEventListener('click', () => {
        sidebar.classList.toggle('-translate-x-full');
    });

    function showSection(hash) {
        const targetId = hash ? hash.substring(1) : 'part1';
        
        contentSections.forEach(section => {
            section.classList.toggle('active', section.id === targetId);
        });

        navLinks.forEach(link => {
            link.classList.toggle('active', link.getAttribute('href') === `#${targetId}`);
        });
        
        // Close mobile menu on navigation
        if (!sidebar.classList.contains('-translate-x-full')) {
            sidebar.classList.add('-translate-x-full');
        }
        
        document.querySelector('main').scrollTop = 0;
    }

    navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href');
            // Use history.pushState for SPA-like navigation without page reload
            if(window.location.hash !== targetId) {
                history.pushState(null, null, targetId);
            }
            showSection(targetId);
        });
    });

    loopTabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const targetId = this.dataset.target;

            loopTabs.forEach(t => {
                t.classList.remove('border-blue-500', 'text-blue-600');
                t.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
            });
            this.classList.add('border-blue-500', 'text-blue-600');
            this.classList.remove('border-transparent', 'text-gray-500');

            loopContents.forEach(content => {
                content.classList.toggle('hidden', content.id !== targetId);
            });
        });
    });
    
    copyButtons.forEach(button => {
        button.addEventListener('click', function() {
            const codeBlock = this.parentElement;
            const codeToCopy = codeBlock.textContent.replace('content_copyCopy', '').trim();
            
            navigator.clipboard.writeText(codeToCopy).then(() => {
                const originalContent = this.innerHTML;
                this.innerHTML = `<span class="material-symbols-outlined text-sm">done</span>Copied!`;
                setTimeout(() => {
                    this.innerHTML = originalContent;
                }, 2000);
            });
        });
    });

    const objectModelData = {
        name: 'Application', icon: 'apps', children: [
            { name: 'Workbooks', icon: 'folder_open', children: [
                { name: 'Workbook ("Sales.xlsx")', icon: 'book', children: [
                    { name: 'Worksheets', icon: 'folder_open', children: [
                        { name: 'Worksheet ("Q1_Data")', icon: 'grid_on', children: [
                            { name: 'Range("A1")', icon: 'view_comfy_alt', children: [] },
                            { name: 'Charts', icon: 'bar_chart', children: [] }
                        ]}
                    ]}
                ]}
            ]}
        ]
    };

    function createObjectModelHTML(item, isRoot = true) {
        let childrenHTML = '';
        if (item.children && item.children.length > 0) {
            childrenHTML = `<div class="children">${item.children.map(child => createObjectModelHTML(child, false)).join('')}</div>`;
        }
        
        const expandedClass = isRoot ? 'expanded' : '';
        const arrowIcon = isRoot ? 'arrow_drop_down' : 'chevron_right';

        return `
            <div class="object-model-item ${expandedClass}">
                <div class="item-header">
                    <span class="material-symbols-outlined">${arrowIcon}</span>
                    <span class="material-symbols-outlined text-yellow-600">${item.icon}</span>
                    <span class="font-semibold">${item.name}</span>
                </div>
                ${childrenHTML}
            </div>
        `;
    }

    const vizContainer = document.getElementById('object-model-viz');
    if(vizContainer) {
        vizContainer.innerHTML = createObjectModelHTML(objectModelData);
        vizContainer.querySelectorAll('.item-header').forEach(header => {
            header.addEventListener('click', function() {
                const parentItem = this.parentElement;
                parentItem.classList.toggle('expanded');
                const arrow = this.querySelector('.material-symbols-outlined');
                if (parentItem.classList.contains('expanded')) {
                    arrow.textContent = 'arrow_drop_down';
                } else {
                    arrow.textContent = 'chevron_right';
                }
            });
        });
    }

    // --- Gemini API Integration ---
    const explainBtn = document.getElementById('explain-btn');
    const generateBtn = document.getElementById('generate-btn');
    const errorBtn = document.getElementById('error-btn');

    const explainInput = document.getElementById('explain-input');
    const generateInput = document.getElementById('generate-input');
    const errorInput = document.getElementById('error-input');

    const explainOutput = document.getElementById('explain-output');
    const generateOutput = document.getElementById('generate-output').querySelector('pre');
    const errorOutput = document.getElementById('error-output');

    const apiKey = ""; 

    async function callGeminiAPI(prompt, outputElement, isCode) {
        outputElement.innerHTML = '<div class="loader"></div>';
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
        
        const payload = {
            contents: [{
                parts: [{ text: prompt }]
            }]
        };

        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorBody = await response.json();
                console.error('API Error Response:', errorBody);
                throw new Error(`API Error: ${response.status} ${response.statusText}`);
            }

            const result = await response.json();
            
            if (result.candidates && result.candidates.length > 0 && result.candidates[0].content.parts.length > 0) {
                let text = result.candidates[0].content.parts[0].text;
                if (isCode) {
                    text = text.replace(/```vba\n/g, '').replace(/```/g, '').trim();
                    outputElement.textContent = text;
                } else {
                    outputElement.textContent = text;
                }
            } else {
                console.warn('Unexpected API response structure:', result);
                outputElement.textContent = 'Sorry, I could not generate a valid response. The API returned an unexpected format.';
            }

        } catch (error) {
            console.error('Gemini API call failed:', error);
            outputElement.textContent = 'An error occurred while contacting the AI assistant. Please check the browser console for details.';
        }
    }

    explainBtn.addEventListener('click', () => {
        const userCode = explainInput.value;
        if (!userCode.trim()) return;
        const prompt = `Explain the following Excel VBA code line by line in a clear, concise way for a beginner:\n\n${userCode}`;
        callGeminiAPI(prompt, explainOutput, false);
    });

    generateBtn.addEventListener('click', () => {
        const userRequest = generateInput.value;
        if (!userRequest.trim()) return;
        const prompt = `Generate only the Excel VBA code to perform the following task. Do not include any explanation, just the code inside a single VBA Sub or Function. Task: ${userRequest}`;
        callGeminiAPI(prompt, generateOutput, true);
    });

    errorBtn.addEventListener('click', () => {
        const userError = errorInput.value;
        if (!userError.trim()) return;
        const prompt = `I got the following error in my Excel VBA code: "${userError}". What are the most common causes for this error and how can I fix it? Provide a clear, step-by-step guide for debugging.`;
        callGeminiAPI(prompt, errorOutput, false);
    });


    window.addEventListener('popstate', () => {
        showSection(window.location.hash);
    });

    // Initial load
    showSection(window.location.hash || '#part1');
});
</script>

</body>
</html>
